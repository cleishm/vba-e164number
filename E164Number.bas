Option Explicit

Dim iso3166 As Collection
Dim e164Map As Collection

Function E164Number(source As String, Optional country As String = "") As Variant
    Dim ccode As Variant
    Dim cntry As Variant
    
    source = ExtractPhoneNumber(source)
    ' TODO: handle extensions, rather than concatenating
    source = E164CharsOnly(source)
    If source = "" Then
        E164Number = CVErr(xlErrValue)
        Exit Function
    End If
    
    ccode = IdentifyE164InternationalPrefix(source)
    If IsError(ccode) Then
        cntry = CountryCode(country)
        If IsError(cntry) Then
            E164Number = CVErr(xlErrValue)
            Exit Function
        End If
        ccode = E164InternationalPrefix(cntry)
        If IsError(ccode) Then
            E164Number = CVErr(xlErrValue)
            Exit Function
        End If
    End If
    
    If Not ccode = "39" Then
        Do While Left(source, 1) = "0"
            source = Mid(source, 2)
        Loop
    End If
    
    E164Number = "+" & ccode & source
End Function

Function E164CharsOnly(source As String) As String
    Dim i As Integer
    Dim result As String
    
    result = ""
    For i = 1 To Len(source)
        Select Case Asc(Mid(source, i, 1))
            Case 43, 48 To 57:
                result = result & Mid(source, i, 1)
        End Select
    Next
    
    E164CharsOnly = result
End Function

Function IdentifyE164InternationalPrefix(ByRef source As String) As Variant
    Dim n As Variant
    Dim l As Integer
    
    E164MapInit
    
    If Left(source, 1) = "+" Then
        source = Mid(source, 2)
    ElseIf Left(source, 2) = "00" Then
        source = Mid(source, 3)
    Else
        IdentifyE164InternationalPrefix = CVErr(xlErrValue)
        Exit Function
    End If
    
    l = Len(source)
    For Each n In e164Map
        If Len(n) <= l And Left(source, Len(n)) = n Then
            IdentifyE164InternationalPrefix = n
            source = Mid(source, Len(n) + 1)
            Exit Function
        End If
    Next
    
    IdentifyE164InternationalPrefix = CVErr(xlErrValue)
End Function

Function ExtractPhoneNumber(source As String) As String
    Dim i As Integer
    
    For i = 1 To Len(source)
        Select Case Asc(Mid(source, i, 1))
            Case 43, 48 To 57:
                Exit For
        End Select
    Next
    ExtractPhoneNumber = RemovePhoneExtension(Mid(source, i))
End Function

Function RemovePhoneExtension(source As String) As String
    Dim i As Integer
    Dim result As String
    
    result = source
    
    i = InStr(result, "/")
    If i <> 0 And IsPhoneExtension(Mid(result, i + 1)) Then
        result = Left(result, i - 1)
    Else
        i = InStr(result, "\")
        If i <> 0 And IsPhoneExtension(Mid(result, i + 1)) Then
            result = Left(result, i - 1)
        End If
    End If
    
    RemovePhoneExtension = result
End Function

Function IsPhoneExtension(source As String) As Boolean
    Dim result As Boolean
    Dim i As Integer
    Dim c As String
    
    result = False
    For i = 1 To Len(source)
        c = Mid(source, i, 1)
        If c = "x" Then
            result = True
            Exit For
        ElseIf c <> " " Then
            Exit For
        End If
    Next
    IsPhoneExtension = result
End Function

Function CountryCode(country) As Variant
    ISO3166Init
    On Error GoTo err
    CountryCode = iso3166.Item(country)
    Exit Function
err:
    CountryCode = CVErr(xlErrValue)
End Function

Function E164InternationalPrefix(code) As Variant
    E164MapInit
    On Error GoTo err
    E164InternationalPrefix = e164Map.Item(code)
    Exit Function
err:
    E164InternationalPrefix = CVErr(xlErrValue)
End Function

Sub ISO3166Init()
    If Not iso3166 Is Nothing Then
        Exit Sub
    End If
    Set iso3166 = New Collection
    iso3166.Add "USA", "US"
    iso3166.Add "USA", "USA"
    iso3166.Add "USA", "United States"
    iso3166.Add "ABW", "AW"
    iso3166.Add "ABW", "ABW"
    iso3166.Add "ABW", "Aruba"
    iso3166.Add "AFG", "AF"
    iso3166.Add "AFG", "AFG"
    iso3166.Add "AFG", "Afghanistan"
    iso3166.Add "AGO", "AO"
    iso3166.Add "AGO", "AGO"
    iso3166.Add "AGO", "Angola"
    iso3166.Add "AIA", "AI"
    iso3166.Add "AIA", "AIA"
    iso3166.Add "AIA", "Anguilla"
    iso3166.Add "ALA", "AX"
    iso3166.Add "ALA", "ALA"
    iso3166.Add "ALA", "Åland Islands"
    iso3166.Add "ALB", "AL"
    iso3166.Add "ALB", "ALB"
    iso3166.Add "ALB", "Albania"
    iso3166.Add "AND", "AD"
    iso3166.Add "AND", "AND"
    iso3166.Add "AND", "Andorra"
    iso3166.Add "ARE", "AE"
    iso3166.Add "ARE", "ARE"
    iso3166.Add "ARE", "United Arab Emirates"
    iso3166.Add "ARG", "AR"
    iso3166.Add "ARG", "ARG"
    iso3166.Add "ARG", "Argentina"
    iso3166.Add "ARM", "AM"
    iso3166.Add "ARM", "ARM"
    iso3166.Add "ARM", "Armenia"
    iso3166.Add "ASM", "AS"
    iso3166.Add "ASM", "ASM"
    iso3166.Add "ASM", "American Samoa"
    iso3166.Add "ATG", "AG"
    iso3166.Add "ATG", "ATG"
    iso3166.Add "ATG", "Antigua and Barbuda"
    iso3166.Add "AUS", "AU"
    iso3166.Add "AUS", "AUS"
    iso3166.Add "AUS", "Australia"
    iso3166.Add "AUT", "AT"
    iso3166.Add "AUT", "AUT"
    iso3166.Add "AUT", "Austria"
    iso3166.Add "AZE", "AZ"
    iso3166.Add "AZE", "AZE"
    iso3166.Add "AZE", "Azerbaijan"
    iso3166.Add "BDI", "BI"
    iso3166.Add "BDI", "BDI"
    iso3166.Add "BDI", "Burundi"
    iso3166.Add "BEL", "BE"
    iso3166.Add "BEL", "BEL"
    iso3166.Add "BEL", "Belgium"
    iso3166.Add "BEN", "BJ"
    iso3166.Add "BEN", "BEN"
    iso3166.Add "BEN", "Benin"
    iso3166.Add "BFA", "BF"
    iso3166.Add "BFA", "BFA"
    iso3166.Add "BFA", "Burkina Faso"
    iso3166.Add "BGD", "BD"
    iso3166.Add "BGD", "BGD"
    iso3166.Add "BGD", "Bangladesh"
    iso3166.Add "BGR", "BG"
    iso3166.Add "BGR", "BGR"
    iso3166.Add "BGR", "Bulgaria"
    iso3166.Add "BHR", "BH"
    iso3166.Add "BHR", "BHR"
    iso3166.Add "BHR", "Bahrain"
    iso3166.Add "BHS", "BS"
    iso3166.Add "BHS", "BHS"
    iso3166.Add "BHS", "Bahamas"
    iso3166.Add "BIH", "BA"
    iso3166.Add "BIH", "BIH"
    iso3166.Add "BIH", "Bosnia and Herzegovina"
    iso3166.Add "BLR", "BY"
    iso3166.Add "BLR", "BLR"
    iso3166.Add "BLR", "Belarus"
    iso3166.Add "BLZ", "BZ"
    iso3166.Add "BLZ", "BLZ"
    iso3166.Add "BLZ", "Belize"
    iso3166.Add "BMU", "BM"
    iso3166.Add "BMU", "BMU"
    iso3166.Add "BMU", "Bermuda"
    iso3166.Add "BOL", "BO"
    iso3166.Add "BOL", "BOL"
    iso3166.Add "BOL", "Bolivia"
    iso3166.Add "BRA", "BR"
    iso3166.Add "BRA", "BRA"
    iso3166.Add "BRA", "Brazil"
    iso3166.Add "BRB", "BB"
    iso3166.Add "BRB", "BRB"
    iso3166.Add "BRB", "Barbados"
    iso3166.Add "BRN", "BN"
    iso3166.Add "BRN", "BRN"
    iso3166.Add "BRN", "Brunei Darussalam"
    iso3166.Add "BTN", "BT"
    iso3166.Add "BTN", "BTN"
    iso3166.Add "BTN", "Bhutan"
    iso3166.Add "BWA", "BW"
    iso3166.Add "BWA", "BWA"
    iso3166.Add "BWA", "Botswana"
    iso3166.Add "CAF", "CF"
    iso3166.Add "CAF", "CAF"
    iso3166.Add "CAF", "Central African Republic"
    iso3166.Add "CAN", "CA"
    iso3166.Add "CAN", "CAN"
    iso3166.Add "CAN", "Canada"
    iso3166.Add "CHE", "CH"
    iso3166.Add "CHE", "CHE"
    iso3166.Add "CHE", "Switzerland"
    iso3166.Add "CHL", "CL"
    iso3166.Add "CHL", "CHL"
    iso3166.Add "CHL", "Chile"
    iso3166.Add "CHN", "CN"
    iso3166.Add "CHN", "CHN"
    iso3166.Add "CHN", "China"
    iso3166.Add "CIV", "CI"
    iso3166.Add "CIV", "CIV"
    iso3166.Add "CIV", "Côte D'Ivoire"
    iso3166.Add "CMR", "CM"
    iso3166.Add "CMR", "CMR"
    iso3166.Add "CMR", "Cameroon"
    iso3166.Add "COD", "CD"
    iso3166.Add "COD", "COD"
    iso3166.Add "COD", "Congo, The Democratic Republic Of The"
    iso3166.Add "COG", "CG"
    iso3166.Add "COG", "COG"
    iso3166.Add "COG", "Congo"
    iso3166.Add "COK", "CK"
    iso3166.Add "COK", "COK"
    iso3166.Add "COK", "Cook Islands"
    iso3166.Add "COL", "CO"
    iso3166.Add "COL", "COL"
    iso3166.Add "COL", "Colombia"
    iso3166.Add "COM", "KM"
    iso3166.Add "COM", "COM"
    iso3166.Add "COM", "Comoros"
    iso3166.Add "CPV", "CV"
    iso3166.Add "CPV", "CPV"
    iso3166.Add "CPV", "Cape Verde"
    iso3166.Add "CRI", "CR"
    iso3166.Add "CRI", "CRI"
    iso3166.Add "CRI", "Costa Rica"
    iso3166.Add "CUB", "CU"
    iso3166.Add "CUB", "CUB"
    iso3166.Add "CUB", "Cuba"
    iso3166.Add "CYM", "KY"
    iso3166.Add "CYM", "CYM"
    iso3166.Add "CYM", "Cayman Islands"
    iso3166.Add "CYP", "CY"
    iso3166.Add "CYP", "CYP"
    iso3166.Add "CYP", "Cyprus"
    iso3166.Add "CZE", "CZ"
    iso3166.Add "CZE", "CZE"
    iso3166.Add "CZE", "Czech Republic"
    iso3166.Add "DEU", "DE"
    iso3166.Add "DEU", "DEU"
    iso3166.Add "DEU", "Germany"
    iso3166.Add "DJI", "DJ"
    iso3166.Add "DJI", "DJI"
    iso3166.Add "DJI", "Djibouti"
    iso3166.Add "DMA", "DM"
    iso3166.Add "DMA", "DMA"
    iso3166.Add "DMA", "Dominica"
    iso3166.Add "DNK", "DK"
    iso3166.Add "DNK", "DNK"
    iso3166.Add "DNK", "Denmark"
    iso3166.Add "DOM", "DO"
    iso3166.Add "DOM", "DOM"
    iso3166.Add "DOM", "Dominican Republic"
    iso3166.Add "DZA", "DZ"
    iso3166.Add "DZA", "DZA"
    iso3166.Add "DZA", "Algeria"
    iso3166.Add "ECU", "EC"
    iso3166.Add "ECU", "ECU"
    iso3166.Add "ECU", "Ecuador"
    iso3166.Add "EGY", "EG"
    iso3166.Add "EGY", "EGY"
    iso3166.Add "EGY", "Egypt"
    iso3166.Add "ERI", "ER"
    iso3166.Add "ERI", "ERI"
    iso3166.Add "ERI", "Eritrea"
    iso3166.Add "ESP", "ES"
    iso3166.Add "ESP", "ESP"
    iso3166.Add "ESP", "Spain"
    iso3166.Add "EST", "EE"
    iso3166.Add "EST", "EST"
    iso3166.Add "EST", "Estonia"
    iso3166.Add "ETH", "ET"
    iso3166.Add "ETH", "ETH"
    iso3166.Add "ETH", "Ethiopia"
    iso3166.Add "FIN", "FI"
    iso3166.Add "FIN", "FIN"
    iso3166.Add "FIN", "Finland"
    iso3166.Add "FJI", "FJ"
    iso3166.Add "FJI", "FJI"
    iso3166.Add "FJI", "Fiji"
    iso3166.Add "FLK", "FK"
    iso3166.Add "FLK", "FLK"
    iso3166.Add "FLK", "Falkland Islands (Malvinas)"
    iso3166.Add "FRA", "FR"
    iso3166.Add "FRA", "FRA"
    iso3166.Add "FRA", "France"
    iso3166.Add "FRO", "FO"
    iso3166.Add "FRO", "FRO"
    iso3166.Add "FRO", "Faroe Islands"
    iso3166.Add "FSM", "FM"
    iso3166.Add "FSM", "FSM"
    iso3166.Add "FSM", "Micronesia, Federated States Of"
    iso3166.Add "GAB", "GA"
    iso3166.Add "GAB", "GAB"
    iso3166.Add "GAB", "Gabon"
    iso3166.Add "GBR", "GB"
    iso3166.Add "GBR", "GBR"
    iso3166.Add "GBR", "United Kingdom"
    iso3166.Add "GEO", "GE"
    iso3166.Add "GEO", "GEO"
    iso3166.Add "GEO", "Georgia"
    iso3166.Add "GHA", "GH"
    iso3166.Add "GHA", "GHA"
    iso3166.Add "GHA", "Ghana"
    iso3166.Add "GIB", "GI"
    iso3166.Add "GIB", "GIB"
    iso3166.Add "GIB", "Gibraltar"
    iso3166.Add "GIN", "GN"
    iso3166.Add "GIN", "GIN"
    iso3166.Add "GIN", "Guinea"
    iso3166.Add "GLP", "GP"
    iso3166.Add "GLP", "GLP"
    iso3166.Add "GLP", "Guadeloupe"
    iso3166.Add "GMB", "GM"
    iso3166.Add "GMB", "GMB"
    iso3166.Add "GMB", "Gambia"
    iso3166.Add "GNB", "GW"
    iso3166.Add "GNB", "GNB"
    iso3166.Add "GNB", "Guinea-Bissau"
    iso3166.Add "GNQ", "GQ"
    iso3166.Add "GNQ", "GNQ"
    iso3166.Add "GNQ", "Equatorial Guinea"
    iso3166.Add "GRC", "GR"
    iso3166.Add "GRC", "GRC"
    iso3166.Add "GRC", "Greece"
    iso3166.Add "GRD", "GD"
    iso3166.Add "GRD", "GRD"
    iso3166.Add "GRD", "Grenada"
    iso3166.Add "GRL", "GL"
    iso3166.Add "GRL", "GRL"
    iso3166.Add "GRL", "Greenland"
    iso3166.Add "GTM", "GT"
    iso3166.Add "GTM", "GTM"
    iso3166.Add "GTM", "Guatemala"
    iso3166.Add "GUF", "GF"
    iso3166.Add "GUF", "GUF"
    iso3166.Add "GUF", "French Guiana"
    iso3166.Add "GUM", "GU"
    iso3166.Add "GUM", "GUM"
    iso3166.Add "GUM", "Guam"
    iso3166.Add "GUY", "GY"
    iso3166.Add "GUY", "GUY"
    iso3166.Add "GUY", "Guyana"
    iso3166.Add "HKG", "HK"
    iso3166.Add "HKG", "HKG"
    iso3166.Add "HKG", "Hong Kong"
    iso3166.Add "HND", "HN"
    iso3166.Add "HND", "HND"
    iso3166.Add "HND", "Honduras"
    iso3166.Add "HRV", "HR"
    iso3166.Add "HRV", "HRV"
    iso3166.Add "HRV", "Croatia"
    iso3166.Add "HTI", "HT"
    iso3166.Add "HTI", "HTI"
    iso3166.Add "HTI", "Haiti"
    iso3166.Add "HUN", "HU"
    iso3166.Add "HUN", "HUN"
    iso3166.Add "HUN", "Hungary"
    iso3166.Add "IDN", "ID"
    iso3166.Add "IDN", "IDN"
    iso3166.Add "IDN", "Indonesia"
    iso3166.Add "IND", "IN"
    iso3166.Add "IND", "IND"
    iso3166.Add "IND", "India"
    iso3166.Add "IRL", "IE"
    iso3166.Add "IRL", "IRL"
    iso3166.Add "IRL", "Ireland"
    iso3166.Add "IRN", "IR"
    iso3166.Add "IRN", "IRN"
    iso3166.Add "IRN", "Iran, Islamic Republic Of"
    iso3166.Add "IRQ", "IQ"
    iso3166.Add "IRQ", "IRQ"
    iso3166.Add "IRQ", "Iraq"
    iso3166.Add "ISL", "IS"
    iso3166.Add "ISL", "ISL"
    iso3166.Add "ISL", "Iceland"
    iso3166.Add "ISR", "IL"
    iso3166.Add "ISR", "ISR"
    iso3166.Add "ISR", "Israel"
    iso3166.Add "ITA", "IT"
    iso3166.Add "ITA", "ITA"
    iso3166.Add "ITA", "Italy"
    iso3166.Add "JAM", "JM"
    iso3166.Add "JAM", "JAM"
    iso3166.Add "JAM", "Jamaica"
    iso3166.Add "JOR", "JO"
    iso3166.Add "JOR", "JOR"
    iso3166.Add "JOR", "Jordan"
    iso3166.Add "JPN", "JP"
    iso3166.Add "JPN", "JPN"
    iso3166.Add "JPN", "Japan"
    iso3166.Add "KAZ", "KZ"
    iso3166.Add "KAZ", "KAZ"
    iso3166.Add "KAZ", "Kazakhstan"
    iso3166.Add "KEN", "KE"
    iso3166.Add "KEN", "KEN"
    iso3166.Add "KEN", "Kenya"
    iso3166.Add "KGZ", "KG"
    iso3166.Add "KGZ", "KGZ"
    iso3166.Add "KGZ", "Kyrgyzstan"
    iso3166.Add "KHM", "KH"
    iso3166.Add "KHM", "KHM"
    iso3166.Add "KHM", "Cambodia"
    iso3166.Add "KIR", "KI"
    iso3166.Add "KIR", "KIR"
    iso3166.Add "KIR", "Kiribati"
    iso3166.Add "KNA", "KN"
    iso3166.Add "KNA", "KNA"
    iso3166.Add "KNA", "Saint Kitts And Nevis"
    iso3166.Add "KOR", "KR"
    iso3166.Add "KOR", "KOR"
    iso3166.Add "KOR", "Korea, Republic of"
    iso3166.Add "KWT", "KW"
    iso3166.Add "KWT", "KWT"
    iso3166.Add "KWT", "Kuwait"
    iso3166.Add "LAO", "LA"
    iso3166.Add "LAO", "LAO"
    iso3166.Add "LAO", "Lao People's Democratic Republic"
    iso3166.Add "LBN", "LB"
    iso3166.Add "LBN", "LBN"
    iso3166.Add "LBN", "Lebanon"
    iso3166.Add "LBR", "LR"
    iso3166.Add "LBR", "LBR"
    iso3166.Add "LBR", "Liberia"
    iso3166.Add "LBY", "LY"
    iso3166.Add "LBY", "LBY"
    iso3166.Add "LBY", "Libyan Arab Jamahiriya"
    iso3166.Add "LCA", "LC"
    iso3166.Add "LCA", "LCA"
    iso3166.Add "LCA", "Saint Lucia"
    iso3166.Add "LIE", "LI"
    iso3166.Add "LIE", "LIE"
    iso3166.Add "LIE", "Liechtenstein"
    iso3166.Add "LKA", "LK"
    iso3166.Add "LKA", "LKA"
    iso3166.Add "LKA", "Sri Lanka"
    iso3166.Add "LSO", "LS"
    iso3166.Add "LSO", "LSO"
    iso3166.Add "LSO", "Lesotho"
    iso3166.Add "LTU", "LT"
    iso3166.Add "LTU", "LTU"
    iso3166.Add "LTU", "Lithuania"
    iso3166.Add "LUX", "LU"
    iso3166.Add "LUX", "LUX"
    iso3166.Add "LUX", "Luxembourg"
    iso3166.Add "LVA", "LV"
    iso3166.Add "LVA", "LVA"
    iso3166.Add "LVA", "Latvia"
    iso3166.Add "MAC", "MO"
    iso3166.Add "MAC", "MAC"
    iso3166.Add "MAC", "Macao"
    iso3166.Add "MAR", "MA"
    iso3166.Add "MAR", "MAR"
    iso3166.Add "MAR", "Morocco"
    iso3166.Add "MCO", "MC"
    iso3166.Add "MCO", "MCO"
    iso3166.Add "MCO", "Monaco"
    iso3166.Add "MDA", "MD"
    iso3166.Add "MDA", "MDA"
    iso3166.Add "MDA", "Moldova, Republic of"
    iso3166.Add "MDG", "MG"
    iso3166.Add "MDG", "MDG"
    iso3166.Add "MDG", "Madagascar"
    iso3166.Add "MDV", "MV"
    iso3166.Add "MDV", "MDV"
    iso3166.Add "MDV", "Maldives"
    iso3166.Add "MEX", "MX"
    iso3166.Add "MEX", "MEX"
    iso3166.Add "MEX", "Mexico"
    iso3166.Add "MHL", "MH"
    iso3166.Add "MHL", "MHL"
    iso3166.Add "MHL", "Marshall Islands"
    iso3166.Add "MKD", "MK"
    iso3166.Add "MKD", "MKD"
    iso3166.Add "MKD", "Macedonia, the Former Yugoslav Republic Of"
    iso3166.Add "MLI", "ML"
    iso3166.Add "MLI", "MLI"
    iso3166.Add "MLI", "Mali"
    iso3166.Add "MLT", "MT"
    iso3166.Add "MLT", "MLT"
    iso3166.Add "MLT", "Malta"
    iso3166.Add "MMR", "MM"
    iso3166.Add "MMR", "MMR"
    iso3166.Add "MMR", "Myanmar"
    iso3166.Add "MNE", "ME"
    iso3166.Add "MNE", "MNE"
    iso3166.Add "MNE", "Montenegro"
    iso3166.Add "MNG", "MN"
    iso3166.Add "MNG", "MNG"
    iso3166.Add "MNG", "Mongolia"
    iso3166.Add "MNP", "MP"
    iso3166.Add "MNP", "MNP"
    iso3166.Add "MNP", "Northern Mariana Islands"
    iso3166.Add "MOZ", "MZ"
    iso3166.Add "MOZ", "MOZ"
    iso3166.Add "MOZ", "Mozambique"
    iso3166.Add "MRT", "MR"
    iso3166.Add "MRT", "MRT"
    iso3166.Add "MRT", "Mauritania"
    iso3166.Add "MSR", "MS"
    iso3166.Add "MSR", "MSR"
    iso3166.Add "MSR", "Montserrat"
    iso3166.Add "MTQ", "MQ"
    iso3166.Add "MTQ", "MTQ"
    iso3166.Add "MTQ", "Martinique"
    iso3166.Add "MUS", "MU"
    iso3166.Add "MUS", "MUS"
    iso3166.Add "MUS", "Mauritius"
    iso3166.Add "MWI", "MW"
    iso3166.Add "MWI", "MWI"
    iso3166.Add "MWI", "Malawi"
    iso3166.Add "MYS", "MY"
    iso3166.Add "MYS", "MYS"
    iso3166.Add "MYS", "Malaysia"
    iso3166.Add "MYT", "YT"
    iso3166.Add "MYT", "MYT"
    iso3166.Add "MYT", "Mayotte"
    iso3166.Add "NAM", "NA"
    iso3166.Add "NAM", "NAM"
    iso3166.Add "NAM", "Namibia"
    iso3166.Add "NCL", "NC"
    iso3166.Add "NCL", "NCL"
    iso3166.Add "NCL", "New Caledonia"
    iso3166.Add "NER", "NE"
    iso3166.Add "NER", "NER"
    iso3166.Add "NER", "Niger"
    iso3166.Add "NFK", "NF"
    iso3166.Add "NFK", "NFK"
    iso3166.Add "NFK", "Norfolk Island"
    iso3166.Add "NGA", "NG"
    iso3166.Add "NGA", "NGA"
    iso3166.Add "NGA", "Nigeria"
    iso3166.Add "NIC", "NI"
    iso3166.Add "NIC", "NIC"
    iso3166.Add "NIC", "Nicaragua"
    iso3166.Add "NIU", "NU"
    iso3166.Add "NIU", "NIU"
    iso3166.Add "NIU", "Niue"
    iso3166.Add "NLD", "NL"
    iso3166.Add "NLD", "NLD"
    iso3166.Add "NLD", "Netherlands"
    iso3166.Add "NOR", "NO"
    iso3166.Add "NOR", "NOR"
    iso3166.Add "NOR", "Norway"
    iso3166.Add "NPL", "NP"
    iso3166.Add "NPL", "NPL"
    iso3166.Add "NPL", "Nepal"
    iso3166.Add "NRU", "NR"
    iso3166.Add "NRU", "NRU"
    iso3166.Add "NRU", "Nauru"
    iso3166.Add "NZL", "NZ"
    iso3166.Add "NZL", "NZL"
    iso3166.Add "NZL", "New Zealand"
    iso3166.Add "OMN", "OM"
    iso3166.Add "OMN", "OMN"
    iso3166.Add "OMN", "Oman"
    iso3166.Add "PAK", "PK"
    iso3166.Add "PAK", "PAK"
    iso3166.Add "PAK", "Pakistan"
    iso3166.Add "PAN", "PA"
    iso3166.Add "PAN", "PAN"
    iso3166.Add "PAN", "Panama"
    iso3166.Add "PER", "PE"
    iso3166.Add "PER", "PER"
    iso3166.Add "PER", "Peru"
    iso3166.Add "PHL", "PH"
    iso3166.Add "PHL", "PHL"
    iso3166.Add "PHL", "Philippines"
    iso3166.Add "PLW", "PW"
    iso3166.Add "PLW", "PLW"
    iso3166.Add "PLW", "Palau"
    iso3166.Add "PNG", "PG"
    iso3166.Add "PNG", "PNG"
    iso3166.Add "PNG", "Papua New Guinea"
    iso3166.Add "POL", "PL"
    iso3166.Add "POL", "POL"
    iso3166.Add "POL", "Poland"
    iso3166.Add "PRI", "PR"
    iso3166.Add "PRI", "PRI"
    iso3166.Add "PRI", "Puerto Rico"
    iso3166.Add "PRT", "PT"
    iso3166.Add "PRT", "PRT"
    iso3166.Add "PRT", "Portugal"
    iso3166.Add "PRY", "PY"
    iso3166.Add "PRY", "PRY"
    iso3166.Add "PRY", "Paraguay"
    iso3166.Add "PSE", "PS"
    iso3166.Add "PSE", "PSE"
    iso3166.Add "PSE", "Palestinian Territory, Occupied"
    iso3166.Add "PYF", "PF"
    iso3166.Add "PYF", "PYF"
    iso3166.Add "PYF", "French Polynesia"
    iso3166.Add "QAT", "QA"
    iso3166.Add "QAT", "QAT"
    iso3166.Add "QAT", "Qatar"
    iso3166.Add "REU", "RE"
    iso3166.Add "REU", "REU"
    iso3166.Add "REU", "Réunion"
    iso3166.Add "ROU", "RO"
    iso3166.Add "ROU", "ROU"
    iso3166.Add "ROU", "Romania"
    iso3166.Add "RUS", "RU"
    iso3166.Add "RUS", "RUS"
    iso3166.Add "RUS", "Russian Federation"
    iso3166.Add "RWA", "RW"
    iso3166.Add "RWA", "RWA"
    iso3166.Add "RWA", "Rwanda"
    iso3166.Add "SAU", "SA"
    iso3166.Add "SAU", "SAU"
    iso3166.Add "SAU", "Saudi Arabia"
    iso3166.Add "SDN", "SD"
    iso3166.Add "SDN", "SDN"
    iso3166.Add "SDN", "Sudan"
    iso3166.Add "SEN", "SN"
    iso3166.Add "SEN", "SEN"
    iso3166.Add "SEN", "Senegal"
    iso3166.Add "SGP", "SG"
    iso3166.Add "SGP", "SGP"
    iso3166.Add "SGP", "Singapore"
    iso3166.Add "SHN", "SH"
    iso3166.Add "SHN", "SHN"
    iso3166.Add "SHN", "Saint Helena"
    iso3166.Add "SJM", "SJ"
    iso3166.Add "SJM", "SJM"
    iso3166.Add "SJM", "Svalbard And Jan Mayen"
    iso3166.Add "SLB", "SB"
    iso3166.Add "SLB", "SLB"
    iso3166.Add "SLB", "Solomon Islands"
    iso3166.Add "SLE", "SL"
    iso3166.Add "SLE", "SLE"
    iso3166.Add "SLE", "Sierra Leone"
    iso3166.Add "SLV", "SV"
    iso3166.Add "SLV", "SLV"
    iso3166.Add "SLV", "El Salvador"
    iso3166.Add "SMR", "SM"
    iso3166.Add "SMR", "SMR"
    iso3166.Add "SMR", "San Marino"
    iso3166.Add "SOM", "SO"
    iso3166.Add "SOM", "SOM"
    iso3166.Add "SOM", "Somalia"
    iso3166.Add "SXM", "SX"
    iso3166.Add "SXM", "SXM"
    iso3166.Add "SXM", "Sint Maarten"
    iso3166.Add "SPM", "PM"
    iso3166.Add "SPM", "SPM"
    iso3166.Add "SPM", "Saint Pierre And Miquelon"
    iso3166.Add "SRB", "RS"
    iso3166.Add "SRB", "SRB"
    iso3166.Add "SRB", "Serbia"
    iso3166.Add "STP", "ST"
    iso3166.Add "STP", "STP"
    iso3166.Add "STP", "Sao Tome and Principe"
    iso3166.Add "SUR", "SR"
    iso3166.Add "SUR", "SUR"
    iso3166.Add "SUR", "Suriname"
    iso3166.Add "SVK", "SK"
    iso3166.Add "SVK", "SVK"
    iso3166.Add "SVK", "Slovakia"
    iso3166.Add "SVN", "SI"
    iso3166.Add "SVN", "SVN"
    iso3166.Add "SVN", "Slovenia"
    iso3166.Add "SWE", "SE"
    iso3166.Add "SWE", "SWE"
    iso3166.Add "SWE", "Sweden"
    iso3166.Add "SYC", "SC"
    iso3166.Add "SYC", "SYC"
    iso3166.Add "SYC", "Seychelles"
    iso3166.Add "SYR", "SY"
    iso3166.Add "SYR", "SYR"
    iso3166.Add "SYR", "Syrian Arab Republic"
    iso3166.Add "TCA", "TC"
    iso3166.Add "TCA", "TCA"
    iso3166.Add "TCA", "Turks and Caicos Islands"
    iso3166.Add "TCD", "TD"
    iso3166.Add "TCD", "TCD"
    iso3166.Add "TCD", "Chad"
    iso3166.Add "TGO", "TG"
    iso3166.Add "TGO", "TGO"
    iso3166.Add "TGO", "Togo"
    iso3166.Add "THA", "TH"
    iso3166.Add "THA", "THA"
    iso3166.Add "THA", "Thailand"
    iso3166.Add "TJK", "TJ"
    iso3166.Add "TJK", "TJK"
    iso3166.Add "TJK", "Tajikistan"
    iso3166.Add "TKL", "TK"
    iso3166.Add "TKL", "TKL"
    iso3166.Add "TKL", "Tokelau"
    iso3166.Add "TKM", "TM"
    iso3166.Add "TKM", "TKM"
    iso3166.Add "TKM", "Turkmenistan"
    iso3166.Add "TLS", "TL"
    iso3166.Add "TLS", "TLS"
    iso3166.Add "TLS", "Timor-Leste"
    iso3166.Add "TON", "TO"
    iso3166.Add "TON", "TON"
    iso3166.Add "TON", "Tonga"
    iso3166.Add "TTO", "TT"
    iso3166.Add "TTO", "TTO"
    iso3166.Add "TTO", "Trinidad and Tobago"
    iso3166.Add "TUN", "TN"
    iso3166.Add "TUN", "TUN"
    iso3166.Add "TUN", "Tunisia"
    iso3166.Add "TUR", "TR"
    iso3166.Add "TUR", "TUR"
    iso3166.Add "TUR", "Turkey"
    iso3166.Add "TUV", "TV"
    iso3166.Add "TUV", "TUV"
    iso3166.Add "TUV", "Tuvalu"
    iso3166.Add "TWN", "TW"
    iso3166.Add "TWN", "TWN"
    iso3166.Add "TWN", "Taiwan, Province Of China"
    iso3166.Add "TZA", "TZ"
    iso3166.Add "TZA", "TZA"
    iso3166.Add "TZA", "Tanzania, United Republic of"
    iso3166.Add "UGA", "UG"
    iso3166.Add "UGA", "UGA"
    iso3166.Add "UGA", "Uganda"
    iso3166.Add "UKR", "UA"
    iso3166.Add "UKR", "UKR"
    iso3166.Add "UKR", "Ukraine"
    iso3166.Add "URY", "UY"
    iso3166.Add "URY", "URY"
    iso3166.Add "URY", "Uruguay"
    iso3166.Add "UZB", "UZ"
    iso3166.Add "UZB", "UZB"
    iso3166.Add "UZB", "Uzbekistan"
    iso3166.Add "VCT", "VC"
    iso3166.Add "VCT", "VCT"
    iso3166.Add "VCT", "Saint Vincent And The Grenedines"
    iso3166.Add "VEN", "VE"
    iso3166.Add "VEN", "VEN"
    iso3166.Add "VEN", "Venezuela, Bolivarian Republic of"
    iso3166.Add "VGB", "VG"
    iso3166.Add "VGB", "VGB"
    iso3166.Add "VGB", "Virgin Islands, British"
    iso3166.Add "VIR", "VI"
    iso3166.Add "VIR", "VIR"
    iso3166.Add "VIR", "Virgin Islands, U.S."
    iso3166.Add "VNM", "VN"
    iso3166.Add "VNM", "VNM"
    iso3166.Add "VNM", "Viet Nam"
    iso3166.Add "VUT", "VU"
    iso3166.Add "VUT", "VUT"
    iso3166.Add "VUT", "Vanuatu"
    iso3166.Add "WLF", "WF"
    iso3166.Add "WLF", "WLF"
    iso3166.Add "WLF", "Wallis and Futuna"
    iso3166.Add "WSM", "WS"
    iso3166.Add "WSM", "WSM"
    iso3166.Add "WSM", "Samoa"
    iso3166.Add "YEM", "YE"
    iso3166.Add "YEM", "YEM"
    iso3166.Add "YEM", "Yemen"
    iso3166.Add "ZAF", "ZA"
    iso3166.Add "ZAF", "ZAF"
    iso3166.Add "ZAF", "South Africa"
    iso3166.Add "ZMB", "ZM"
    iso3166.Add "ZMB", "ZMB"
    iso3166.Add "ZMB", "Zambia"
    iso3166.Add "ZWE", "ZW"
    iso3166.Add "ZWE", "ZWE"
    iso3166.Add "ZWE", "Zimbabwe"
End Sub

Sub ISO3166Cleanup()
    Set iso3166 = Nothing
End Sub

Sub E164MapInit()
    If Not e164Map Is Nothing Then
        Exit Sub
    End If
    Set e164Map = New Collection
    e164Map.Add "1", "USA"
    e164Map.Add "297", "ABW"
    e164Map.Add "93", "AFG"
    e164Map.Add "244", "AGO"
    e164Map.Add "1", "AIA"
    e164Map.Add "358", "ALA"
    e164Map.Add "355", "ALB"
    e164Map.Add "376", "AND"
    e164Map.Add "971", "ARE"
    e164Map.Add "54", "ARG"
    e164Map.Add "374", "ARM"
    e164Map.Add "1", "ASM"
    e164Map.Add "1", "ATG"
    e164Map.Add "61", "AUS"
    e164Map.Add "43", "AUT"
    e164Map.Add "994", "AZE"
    e164Map.Add "257", "BDI"
    e164Map.Add "32", "BEL"
    e164Map.Add "229", "BEN"
    e164Map.Add "226", "BFA"
    e164Map.Add "880", "BGD"
    e164Map.Add "359", "BGR"
    e164Map.Add "973", "BHR"
    e164Map.Add "1", "BHS"
    e164Map.Add "387", "BIH"
    e164Map.Add "375", "BLR"
    e164Map.Add "501", "BLZ"
    e164Map.Add "1", "BMU"
    e164Map.Add "591", "BOL"
    e164Map.Add "55", "BRA"
    e164Map.Add "1", "BRB"
    e164Map.Add "673", "BRN"
    e164Map.Add "975", "BTN"
    e164Map.Add "267", "BWA"
    e164Map.Add "236", "CAF"
    e164Map.Add "1", "CAN"
    e164Map.Add "41", "CHE"
    e164Map.Add "56", "CHL"
    e164Map.Add "86", "CHN"
    e164Map.Add "225", "CIV"
    e164Map.Add "237", "CMR"
    e164Map.Add "243", "COD"
    e164Map.Add "242", "COG"
    e164Map.Add "682", "COK"
    e164Map.Add "57", "COL"
    e164Map.Add "269", "COM"
    e164Map.Add "238", "CPV"
    e164Map.Add "506", "CRI"
    e164Map.Add "53", "CUB"
    e164Map.Add "1", "CYM"
    e164Map.Add "357", "CYP"
    e164Map.Add "420", "CZE"
    e164Map.Add "49", "DEU"
    e164Map.Add "253", "DJI"
    e164Map.Add "1", "DMA"
    e164Map.Add "45", "DNK"
    e164Map.Add "1", "DOM"
    e164Map.Add "213", "DZA"
    e164Map.Add "593", "ECU"
    e164Map.Add "20", "EGY"
    e164Map.Add "291", "ERI"
    e164Map.Add "34", "ESP"
    e164Map.Add "372", "EST"
    e164Map.Add "251", "ETH"
    e164Map.Add "358", "FIN"
    e164Map.Add "679", "FJI"
    e164Map.Add "500", "FLK"
    e164Map.Add "33", "FRA"
    e164Map.Add "298", "FRO"
    e164Map.Add "691", "FSM"
    e164Map.Add "241", "GAB"
    e164Map.Add "44", "GBR"
    e164Map.Add "995", "GEO"
    e164Map.Add "233", "GHA"
    e164Map.Add "350", "GIB"
    e164Map.Add "224", "GIN"
    e164Map.Add "590", "GLP"
    e164Map.Add "220", "GMB"
    e164Map.Add "245", "GNB"
    e164Map.Add "240", "GNQ"
    e164Map.Add "30", "GRC"
    e164Map.Add "1", "GRD"
    e164Map.Add "299", "GRL"
    e164Map.Add "502", "GTM"
    e164Map.Add "594", "GUF"
    e164Map.Add "1", "GUM"
    e164Map.Add "592", "GUY"
    e164Map.Add "852", "HKG"
    e164Map.Add "504", "HND"
    e164Map.Add "385", "HRV"
    e164Map.Add "509", "HTI"
    e164Map.Add "36", "HUN"
    e164Map.Add "62", "IDN"
    e164Map.Add "91", "IND"
    e164Map.Add "353", "IRL"
    e164Map.Add "98", "IRN"
    e164Map.Add "964", "IRQ"
    e164Map.Add "354", "ISL"
    e164Map.Add "972", "ISR"
    e164Map.Add "39", "ITA"
    e164Map.Add "1", "JAM"
    e164Map.Add "962", "JOR"
    e164Map.Add "81", "JPN"
    e164Map.Add "7", "KAZ"
    e164Map.Add "254", "KEN"
    e164Map.Add "996", "KGZ"
    e164Map.Add "855", "KHM"
    e164Map.Add "686", "KIR"
    e164Map.Add "1", "KNA"
    e164Map.Add "82", "KOR"
    e164Map.Add "965", "KWT"
    e164Map.Add "856", "LAO"
    e164Map.Add "961", "LBN"
    e164Map.Add "231", "LBR"
    e164Map.Add "218", "LBY"
    e164Map.Add "1", "LCA"
    e164Map.Add "423", "LIE"
    e164Map.Add "94", "LKA"
    e164Map.Add "266", "LSO"
    e164Map.Add "370", "LTU"
    e164Map.Add "352", "LUX"
    e164Map.Add "371", "LVA"
    e164Map.Add "853", "MAC"
    e164Map.Add "212", "MAR"
    e164Map.Add "377", "MCO"
    e164Map.Add "373", "MDA"
    e164Map.Add "261", "MDG"
    e164Map.Add "960", "MDV"
    e164Map.Add "52", "MEX"
    e164Map.Add "692", "MHL"
    e164Map.Add "389", "MKD"
    e164Map.Add "223", "MLI"
    e164Map.Add "356", "MLT"
    e164Map.Add "95", "MMR"
    e164Map.Add "382", "MNE"
    e164Map.Add "976", "MNG"
    e164Map.Add "1", "MNP"
    e164Map.Add "258", "MOZ"
    e164Map.Add "222", "MRT"
    e164Map.Add "1", "MSR"
    e164Map.Add "596", "MTQ"
    e164Map.Add "230", "MUS"
    e164Map.Add "265", "MWI"
    e164Map.Add "60", "MYS"
    e164Map.Add "269", "MYT"
    e164Map.Add "264", "NAM"
    e164Map.Add "687", "NCL"
    e164Map.Add "227", "NER"
    e164Map.Add "672", "NFK"
    e164Map.Add "234", "NGA"
    e164Map.Add "505", "NIC"
    e164Map.Add "683", "NIU"
    e164Map.Add "31", "NLD"
    e164Map.Add "47", "NOR"
    e164Map.Add "977", "NPL"
    e164Map.Add "674", "NRU"
    e164Map.Add "64", "NZL"
    e164Map.Add "968", "OMN"
    e164Map.Add "92", "PAK"
    e164Map.Add "507", "PAN"
    e164Map.Add "51", "PER"
    e164Map.Add "63", "PHL"
    e164Map.Add "680", "PLW"
    e164Map.Add "675", "PNG"
    e164Map.Add "48", "POL"
    e164Map.Add "1", "PRI"
    e164Map.Add "351", "PRT"
    e164Map.Add "595", "PRY"
    e164Map.Add "970", "PSE"
    e164Map.Add "689", "PYF"
    e164Map.Add "974", "QAT"
    e164Map.Add "262", "REU"
    e164Map.Add "40", "ROU"
    e164Map.Add "7", "RUS"
    e164Map.Add "250", "RWA"
    e164Map.Add "966", "SAU"
    e164Map.Add "249", "SDN"
    e164Map.Add "221", "SEN"
    e164Map.Add "65", "SGP"
    e164Map.Add "290", "SHN"
    e164Map.Add "47", "SJM"
    e164Map.Add "677", "SLB"
    e164Map.Add "232", "SLE"
    e164Map.Add "503", "SLV"
    e164Map.Add "378", "SMR"
    e164Map.Add "252", "SOM"
    e164Map.Add "1", "SXM"
    e164Map.Add "508", "SPM"
    e164Map.Add "381", "SRB"
    e164Map.Add "239", "STP"
    e164Map.Add "597", "SUR"
    e164Map.Add "421", "SVK"
    e164Map.Add "386", "SVN"
    e164Map.Add "46", "SWE"
    e164Map.Add "248", "SYC"
    e164Map.Add "963", "SYR"
    e164Map.Add "1", "TCA"
    e164Map.Add "235", "TCD"
    e164Map.Add "228", "TGO"
    e164Map.Add "66", "THA"
    e164Map.Add "992", "TJK"
    e164Map.Add "690", "TKL"
    e164Map.Add "993", "TKM"
    e164Map.Add "670", "TLS"
    e164Map.Add "676", "TON"
    e164Map.Add "1", "TTO"
    e164Map.Add "216", "TUN"
    e164Map.Add "90", "TUR"
    e164Map.Add "688", "TUV"
    e164Map.Add "886", "TWN"
    e164Map.Add "255", "TZA"
    e164Map.Add "256", "UGA"
    e164Map.Add "380", "UKR"
    e164Map.Add "598", "URY"
    e164Map.Add "998", "UZB"
    e164Map.Add "1", "VCT"
    e164Map.Add "58", "VEN"
    e164Map.Add "1", "VGB"
    e164Map.Add "1", "VIR"
    e164Map.Add "84", "VNM"
    e164Map.Add "678", "VUT"
    e164Map.Add "681", "WLF"
    e164Map.Add "685", "WSM"
    e164Map.Add "967", "YEM"
    e164Map.Add "27", "ZAF"
    e164Map.Add "260", "ZMB"
    e164Map.Add "263", "ZWE"
End Sub

Sub E164MapCleanup()
    Set e164Map = Nothing
End Sub
